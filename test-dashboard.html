<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blessin Finance Database Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: #333;
          line-height: 1.6;
          min-height: 100vh;
          padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
          background: rgba(255, 255, 255, 0.95); 
          padding: 30px; 
          border-radius: 16px; 
          margin-bottom: 30px; 
          box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header h1 { color: #2563eb; font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        
        .json-upload {
          background: rgba(255, 255, 255, 0.95);
          padding: 40px;
          border-radius: 12px;
          margin-bottom: 30px;
          box-shadow: 0 4px 16px rgba(0,0,0,0.1);
          border: 2px dashed #d1d5db;
          text-align: center;
          transition: all 0.3s ease;
        }
        .json-upload:hover { border-color: #3b82f6; }
        .json-upload.dragover { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
        .json-upload input { display: none; }
        .json-upload-btn {
          background: #3b82f6;
          color: white;
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 500;
          transition: background 0.3s ease;
        }
        .json-upload-btn:hover { background: #2563eb; }
        
        .dashboard-content {
          display: none;
        }
        .dashboard-content.active {
          display: block;
        }
        
        .nav-tabs {
          display: flex;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 12px;
          padding: 8px;
          margin-bottom: 30px;
          gap: 8px;
          box-shadow: 0 4px 16px rgba(0,0,0,0.1);
          flex-wrap: wrap;
        }
        .nav-tab {
          padding: 12px 20px;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 500;
          white-space: nowrap;
          border: 1px solid transparent;
        }
        .nav-tab:hover { background: rgba(59, 130, 246, 0.1); }
        .nav-tab.active { 
          background: #3b82f6; 
          color: white; 
          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .data-section {
          background: rgba(255, 255, 255, 0.95); 
          padding: 30px; 
          border-radius: 16px; 
          margin-bottom: 30px; 
          box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .stats-grid { 
          display: grid; 
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
          gap: 16px; 
          margin-bottom: 30px; 
        }
        .stat-card { 
          background: white; 
          padding: 20px; 
          border-radius: 12px; 
          text-align: center; 
          box-shadow: 0 4px 16px rgba(0,0,0,0.1);
          border: 1px solid #e5e7eb;
        }
        .stat-value { font-size: 2rem; font-weight: 800; color: #2563eb; margin-bottom: 6px; }
        .stat-label { color: #6b7280; font-weight: 500; font-size: 0.9rem; }
        
        .data-table { 
          width: 100%; 
          border-collapse: collapse; 
          margin-top: 20px;
          background: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .data-table th, .data-table td { 
          padding: 12px 16px; 
          text-align: left; 
          border-bottom: 1px solid #e5e7eb; 
        }
        .data-table th { 
          background: #f8fafc; 
          font-weight: 600; 
          color: #374151; 
        }
        .data-table tr:hover { background: #f9fafb; }
        .data-table tr:last-child td { border-bottom: none; }
        
        .status-badge {
          padding: 4px 8px;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 500;
        }
        .status-active { background: #dbeafe; color: #1d4ed8; }
        .status-inactive { background: #f3f4f6; color: #6b7280; }
        
        .search-box {
          width: 100%;
          padding: 12px 16px;
          border: 1px solid #d1d5db;
          border-radius: 8px;
          font-size: 1rem;
          margin-bottom: 20px;
          background: white;
        }
        .search-box:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Blessin Finance Dashboard Test</h1>
            <p>Test the JSON upload functionality</p>
        </div>

        <div class="json-upload" id="jsonUpload">
            <div style="margin-bottom: 15px;">
                <h3 style="color: #374151; margin-bottom: 8px;">üìÅ Load Backup Data</h3>
                <p style="color: #6b7280; font-size: 14px;">Drop your JSON backup file here or click to select</p>
            </div>
            <input type="file" id="jsonFileInput" accept=".json">
            <button class="json-upload-btn" onclick="document.getElementById('jsonFileInput').click()">
                üìÇ Select JSON File
            </button>
            <div id="uploadStatus" style="margin-top: 15px; font-size: 14px; font-weight: 500;"></div>
        </div>

        <div id="dashboardContent" class="dashboard-content">
            <div class="nav-tabs" id="navTabs">
                <!-- Navigation tabs will be generated dynamically -->
            </div>

            <div id="tabContents">
                <!-- Tab contents will be generated dynamically -->
            </div>
        </div>
    </div>

    <script>
        let globalData = null;
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const jsonUpload = document.getElementById('jsonUpload');
            const jsonFileInput = document.getElementById('jsonFileInput');
            const uploadStatus = document.getElementById('uploadStatus');
            const dashboardContent = document.getElementById('dashboardContent');
            
            console.log('DOM loaded, initializing upload handlers...');
            
            // File input change event
            if (jsonFileInput) {
                jsonFileInput.addEventListener('change', (e) => {
                    console.log('File input changed');
                    if (e.target.files.length > 0) {
                        handleFileUpload(e.target.files[0]);
                    }
                });
            }
            
            // Drag and drop functionality
            if (jsonUpload) {
                jsonUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    jsonUpload.classList.add('dragover');
                });
                
                jsonUpload.addEventListener('dragleave', () => {
                    jsonUpload.classList.remove('dragover');
                });
                
                jsonUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    jsonUpload.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    console.log('Files dropped:', files.length);
                    if (files.length > 0) {
                        handleFileUpload(files[0]);
                    }
                });
            }
            
            function handleFileUpload(file) {
                console.log('Handling file upload:', file.name);
                
                if (!file.name.endsWith('.json')) {
                    uploadStatus.innerHTML = '<span style="color: #ef4444;">‚ùå Please select a JSON file</span>';
                    return;
                }
                
                uploadStatus.innerHTML = '<span style="color: #3b82f6;">‚è≥ Loading data...</span>';
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        console.log('File read successfully, parsing JSON...');
                        const jsonData = JSON.parse(e.target.result);
                        console.log('JSON parsed:', jsonData);
                        
                        globalData = jsonData.data || jsonData;
                        console.log('Global data set:', globalData);
                        
                        uploadStatus.innerHTML = '<span style="color: #10b981;">‚úÖ Data loaded successfully!</span>';
                        
                        // Hide upload section and show dashboard
                        jsonUpload.style.display = 'none';
                        dashboardContent.classList.add('active');
                        
                        // Generate dashboard
                        generateDashboard(globalData);
                        
                    } catch (error) {
                        console.error('JSON parsing error:', error);
                        uploadStatus.innerHTML = '<span style="color: #ef4444;">‚ùå Invalid JSON file: ' + error.message + '</span>';
                    }
                };
                reader.readAsText(file);
            }
        });
        
        function generateDashboard(data) {
            console.log('Generating dashboard with data:', data);
            generateNavigationTabs(data);
            generateTabContents(data);
            
            // Show first available tab
            setTimeout(() => {
                const firstTab = document.querySelector('.nav-tab');
                if (firstTab) {
                    firstTab.click();
                }
            }, 100);
        }
        
        function generateNavigationTabs(data) {
            console.log('Generating navigation tabs');
            const navTabs = document.getElementById('navTabs');
            if (!navTabs) return;
            
            const tabs = [];
            
            // Check what data we have
            console.log('Data keys:', Object.keys(data));
            
            if (data.users && data.users.length > 0) {
                tabs.push('<div class="nav-tab" onclick="showTab(\'users\')">üë• Users (' + data.users.length + ')</div>');
            }
            
            if (data.products && data.products.length > 0) {
                tabs.push('<div class="nav-tab" onclick="showTab(\'products\')">üì¶ Products (' + data.products.length + ')</div>');
            }
            
            if (data.settings && data.settings.length > 0) {
                tabs.push('<div class="nav-tab" onclick="showTab(\'settings\')">‚öôÔ∏è Settings</div>');
            }
            
            console.log('Generated tabs:', tabs.length);
            navTabs.innerHTML = tabs.join('');
        }
        
        function generateTabContents(data) {
            console.log('Generating tab contents');
            const tabContents = document.getElementById('tabContents');
            if (!tabContents) return;
            
            const contents = [];
            
            // Users Tab
            if (data.users && data.users.length > 0) {
                const activeUsers = data.users.filter(user => user.is_active !== false).length;
                const resellers = data.users.filter(user => user.role === 'reseller').length;
                
                contents.push(`
                    <div id="users-content" class="tab-content">
                        <div class="data-section">
                            <h3>üë• Users & Resellers</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">${data.users.length}</div>
                                    <div class="stat-label">Total Users</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${activeUsers}</div>
                                    <div class="stat-label">Active Users</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">${resellers}</div>
                                    <div class="stat-label">Resellers</div>
                                </div>
                            </div>
                            <input type="text" class="search-box" placeholder="üîç Search users..." onkeyup="searchTable(this, 'users-table')">
                            <table class="data-table" id="users-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Region</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.users.filter(user => user.name).map(user => `
                                        <tr>
                                            <td><strong>${user.name || 'Unknown'}</strong></td>
                                            <td>${user.email || 'N/A'}</td>
                                            <td><span class="status-badge ${user.role === 'reseller' ? 'status-active' : 'status-inactive'}">${user.role || 'user'}</span></td>
                                            <td>${user.region || 'N/A'}</td>
                                            <td><span class="status-badge ${user.is_active !== false ? 'status-active' : 'status-inactive'}">${user.is_active !== false ? 'Active' : 'Inactive'}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `);
            }
            
            // Products Tab
            if (data.products && data.products.length > 0) {
                contents.push(`
                    <div id="products-content" class="tab-content">
                        <div class="data-section">
                            <h3>üì¶ Products Catalog</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value">${data.products.length}</div>
                                    <div class="stat-label">Total Products</div>
                                </div>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Category</th>
                                        <th>MRP</th>
                                        <th>Cost Price</th>
                                        <th>Availability</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.products.map(product => `
                                        <tr>
                                            <td><strong>${product.name || 'Unnamed Product'}</strong></td>
                                            <td>${product.category || 'Uncategorized'}</td>
                                            <td>‚Çπ${product.mrp || 0}</td>
                                            <td>‚Çπ${product.cost_price || 0}</td>
                                            <td>${product.availability || 'Unknown'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `);
            }
            
            // Settings Tab
            if (data.settings && data.settings.length > 0) {
                contents.push(`
                    <div id="settings-content" class="tab-content">
                        <div class="data-section">
                            <h3>‚öôÔ∏è Settings</h3>
                            <p>Settings data available: ${data.settings.length} entries</p>
                        </div>
                    </div>
                `);
            }
            
            console.log('Generated content sections:', contents.length);
            tabContents.innerHTML = contents.join('');
        }
        
        // Tab functionality
        function showTab(tabName) {
            console.log('Showing tab:', tabName);
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedContent = document.getElementById(tabName + '-content');
            if (selectedContent) {
                selectedContent.classList.add('active');
            }
            
            // Add active class to selected tab
            const selectedTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }
        
        // Search functionality
        function searchTable(inputElement, tableId) {
            const searchTerm = inputElement.value.toLowerCase();
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 1; i < rows.length; i++) { // Skip header row
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].textContent.toLowerCase().includes(searchTerm)) {
                        found = true;
                        break;
                    }
                }
                
                row.style.display = found ? '' : 'none';
            }
        }
    </script>
</body>
</html>
